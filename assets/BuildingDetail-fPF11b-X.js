import{_ as I,c as P,o as $,w as t,a,r as g,b as s,t as T,d as u,e as z,f as k,i as y,u as N,g as W,h as v}from"./index-BBIFGZDO.js";const R={name:"BuildingDetail",setup(){const w=N(),o=u(""),C=u(""),r=u(""),U={A:"1",B:"2",C:"3",D:"4"},x=u([]),c=u([]),m=u(null),i=u(null),n=u(null),h=u(null),D=async()=>{try{const e=await W.get("http://localhost:3000/buildings"),d=Array.isArray(e.data)?e.data:e.data.buildings,p=U[o.value]||o.value;console.log("转换后的ID:",p),console.log("所有建筑ID:",d.map(b=>b.id));const f=d.find(b=>String(b.id)===String(p));return console.log("找到的建筑:",f),f}catch(e){return console.error("获取建筑数据失败:",e),null}},_=async()=>{o.value=w.params.id,r.value=await D(),r.value&&(C.value=r.value.name,O(),A())},O=()=>{r.value&&(x.value=r.value.floors.map(e=>({floor:`${e.floor}层`,waterUsage:e.monthlyTotal.waterUsage,waterCost:e.monthlyTotal.waterCost})),c.value=r.value.floors.map(e=>({floor:`${e.floor}层`,electricityUsage:e.monthlyTotal.electricityUsage,electricityCost:e.monthlyTotal.electricityCost})))},A=()=>{if(!r.value)return;const e=r.value.floors,d=e.map(l=>({value:l.monthlyTotal.electricityUsage,name:`${l.floor}层`})),p=e[0].weeklyUsage.map(l=>l.day),f=e.map(l=>({name:`${l.floor}层`,type:"line",data:l.weeklyUsage.map(L=>L.electricityUsage)})),b=e.map(l=>({value:l.monthlyTotal.waterUsage,name:`${l.floor}层`})),S=e.map(l=>({name:`${l.floor}层`,type:"line",data:l.weeklyUsage.map(L=>L.waterUsage)}));v(m.value).setOption({series:[{data:d}]}),v(i.value).setOption({legend:{data:e.map(l=>`${l.floor}层`)},xAxis:{data:p},series:f}),v(n.value).setOption({series:[{data:b}]}),v(h.value).setOption({legend:{data:e.map(l=>`${l.floor}层`)},xAxis:{data:p},series:S})},B=()=>{const e=y(m.value);e.setOption({title:{text:"用电分布",left:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"vertical",right:10,top:"center"},series:[{name:"用电量(度)",type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:"18",fontWeight:"bold"}},labelLine:{show:!1},data:[]}]});const d=y(i.value);d.setOption({title:{text:"用电趋势",left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{data:[],bottom:10},grid:{left:"3%",right:"4%",bottom:"15%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:[]},yAxis:{type:"value",name:"用电量(度)"},series:[]});const p=y(n.value);p.setOption({title:{text:"用水分布",left:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"vertical",right:10,top:"center"},series:[{name:"用水量(吨)",type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:"18",fontWeight:"bold"}},labelLine:{show:!1},data:[]}]});const f=y(h.value);f.setOption({title:{text:"用水趋势",left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{data:[],bottom:10},grid:{left:"3%",right:"4%",bottom:"15%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:[]},yAxis:{type:"value",name:"用水量(吨)"},series:[]}),window.addEventListener("resize",function(){e.resize(),d.resize(),p.resize(),f.resize()})};return z(()=>{B(),_()}),k(()=>w.params.id,(e,d)=>{e!==d&&_()}),{buildingName:C,waterTableData:x,electricityTableData:c,electricityPieChart:m,electricityLineChart:i,waterPieChart:n,waterLineChart:h}}},G={class:"card-header"},M={class:"card-header"},V={ref:"electricityPieChart",class:"chart"},E={ref:"electricityLineChart",class:"chart"},j={ref:"waterPieChart",class:"chart"},q={ref:"waterLineChart",class:"chart"};function F(w,o,C,r,U,x){const c=g("el-table-column"),m=g("el-table"),i=g("el-card"),n=g("el-col"),h=g("el-row"),D=g("el-main"),_=g("el-container");return $(),P(_,null,{default:t(()=>[a(D,null,{default:t(()=>[a(h,{gutter:20,class:"row"},{default:t(()=>[a(n,{span:12},{default:t(()=>[a(i,{class:"card"},{header:t(()=>[s("div",G,[s("span",null,T(r.buildingName)+"用水情况",1)])]),default:t(()=>[a(m,{data:r.waterTableData,border:"",style:{width:"100%"},height:"300"},{default:t(()=>[a(c,{prop:"floor",label:"楼层",width:"80"}),a(c,{prop:"waterUsage",label:"用水量(吨)"}),a(c,{prop:"waterCost",label:"费用(元)"})]),_:1},8,["data"])]),_:1})]),_:1}),a(n,{span:12},{default:t(()=>[a(i,{class:"card"},{header:t(()=>[s("div",M,[s("span",null,T(r.buildingName)+"用电情况",1)])]),default:t(()=>[a(m,{data:r.electricityTableData,border:"",style:{width:"100%"},height:"300"},{default:t(()=>[a(c,{prop:"floor",label:"楼层",width:"80"}),a(c,{prop:"electricityUsage",label:"用电量(度)"}),a(c,{prop:"electricityCost",label:"费用(元)"})]),_:1},8,["data"])]),_:1})]),_:1})]),_:1}),a(h,{gutter:20,class:"row"},{default:t(()=>[a(n,{span:12},{default:t(()=>[a(i,{class:"card"},{header:t(()=>o[0]||(o[0]=[s("div",{class:"card-header"},[s("span",null,"每层楼用电分布")],-1)])),default:t(()=>[s("div",V,null,512)]),_:1})]),_:1}),a(n,{span:12},{default:t(()=>[a(i,{class:"card"},{header:t(()=>o[1]||(o[1]=[s("div",{class:"card-header"},[s("span",null,"每层楼用电趋势")],-1)])),default:t(()=>[s("div",E,null,512)]),_:1})]),_:1})]),_:1}),a(h,{gutter:20,class:"row"},{default:t(()=>[a(n,{span:12},{default:t(()=>[a(i,{class:"card"},{header:t(()=>o[2]||(o[2]=[s("div",{class:"card-header"},[s("span",null,"每层楼用水分布")],-1)])),default:t(()=>[s("div",j,null,512)]),_:1})]),_:1}),a(n,{span:12},{default:t(()=>[a(i,{class:"card"},{header:t(()=>o[3]||(o[3]=[s("div",{class:"card-header"},[s("span",null,"每层楼用水趋势")],-1)])),default:t(()=>[s("div",q,null,512)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}const Y=I(R,[["render",F],["__scopeId","data-v-ee150888"]]);export{Y as default};
